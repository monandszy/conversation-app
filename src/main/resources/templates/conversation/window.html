<!DOCTYPE html>
<html
  lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout.html}"
  xmlns:th="http://www.thymeleaf.org"
>
<head>
  <title>Conversation</title>
  <link hx-preserve="true" rel="stylesheet" href="/css/conversation_styles.css"/>
  <script hx-preserve="true" src="/js/conversation_scripts.js" defer></script>
  <script hx-preserve="true" hx-head="re-eval" src="/js/window_scripts.js" defer></script>
</head>
<th:block layout:fragment="content">
  <div id="content" class="conversation-content">
    <div th:replace="~{conversation/sidebar :: fragment}"></div>
    <div id="conversation-wrapper">
      <th:block th:fragment="fragment">
        <head th:if="${isHxRequest == 'true'}" hx-head="merge">
          <title>Conversation</title>
          <link hx-preserve="true" rel="stylesheet" href="/css/conversation_styles.css"/>
          <script hx-preserve="true" src="/js/conversation_scripts.js" defer></script>
          <script hx-preserve="true" hx-head="re-eval" src="/js/window_scripts.js" defer></script>
        </head>
        <div id="window-wrapper">
          <div id="window-content">
            <script>
              // Prevent "Enter" from creating a new line in any editable paragraph
              document.addEventListener("keydown", function (event) {
                if (event.target.classList.contains("request") && event.key === "Enter") {
                  if (event.ctrlKey) {
                    event.preventDefault();
                    event.target.blur()
                  }
                }
              });
              function updateHiddenInput(paragraph) {
                var hiddenInput = paragraph.nextElementSibling;
                hiddenInput.value = paragraph.innerText;
              }
            </script>
            <div th:replace="~{conversation/window-content :: fragment(${sectionPage})}"></div>
          </div>
        </div>
      </th:block>
      <div th:replace="~{conversation/generate-form :: fragment}"></div>
    </div>
    <div>
      <script th:inline="javascript" defer>
        globalConversationId = /*[[${conversationId}]]*/ 'null'
        document.getElementById('submit-button').innerText = 'Post_Generate';
      </script>
    </div>
  </div>
</th:block>
</html>